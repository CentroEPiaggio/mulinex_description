<robot xmlns:xacro="http://ros.org/wiki/xacro">

    <xacro:include filename="$(find mulinex_description)/urdf/links.xacro" />
    <xacro:property name="PI" value="3.141592" />

    <xacro:macro name="leg" params="prefix gazebo jnt_pref">
        <xacro:if value="${prefix == 'LF'}">
            <xacro:property name="base_to_hip_xyz" value="${base_2_HAA_x} ${base_2_HAA_y} 0" />
            <xacro:property name="hip_to_upper_leg_xyz" value="${HAA_2_HFE_x} ${HAA_2_HFE_y} 0" />
            <xacro:property name="hip_to_upper_leg_rpy" value="0 0 0"/>
            <xacro:property name="hip_to_upper_leg_rpy" value="0 0 0" />
            <xacro:property name="upper_to_lower_leg_xyz" value="${HFE_2_KFE_x} ${HFE_2_KFE_y} 0" />
        </xacro:if>
        <xacro:if
            value="${prefix == 'LH'}">
            <xacro:property name="base_to_hip_xyz" value="${-base_2_HAA_x} ${base_2_HAA_y} 0" />
            <xacro:property name="hip_to_upper_leg_xyz" value="${-HAA_2_HFE_x} ${HAA_2_HFE_y} 0" />
            <xacro:property name="hip_to_upper_leg_rpy" value="0 0 0"/>
            <xacro:property name="hip_to_upper_leg_rpy" value="0 0 0" />
            <xacro:property name="upper_to_lower_leg_xyz" value="${-HFE_2_KFE_x} ${HFE_2_KFE_y} 0" />
        </xacro:if>
        <xacro:if
            value="${prefix == 'RF'}">
            <xacro:property name="base_to_hip_xyz" value="${base_2_HAA_x} ${-base_2_HAA_y} 0" />
            <xacro:property name="hip_to_upper_leg_xyz" value="${HAA_2_HFE_x} ${-HAA_2_HFE_y} 0" />
            <xacro:property name="hip_to_upper_leg_rpy" value="0 0 0"/>
            <xacro:property name="hip_to_upper_leg_rpy" value="0 0 0" />
            <xacro:property name="upper_to_lower_leg_xyz" value="${HFE_2_KFE_x} ${-HFE_2_KFE_y} 0" />
        </xacro:if>
        <xacro:if
            value="${prefix == 'RH'}">
            <xacro:property name="base_to_hip_xyz" value="${-base_2_HAA_x} ${-base_2_HAA_y} 0" />
            <xacro:property name="hip_to_upper_leg_xyz" value="${-HAA_2_HFE_x} ${-HAA_2_HFE_y} 0" />
            <xacro:property name="hip_to_upper_leg_rpy" value="0 0 0"/>
            <xacro:property name="hip_to_upper_leg_rpy" value="0 0 0" />
            <xacro:property name="upper_to_lower_leg_xyz" value="${-HFE_2_KFE_x} ${-HFE_2_KFE_y} 0" />
        </xacro:if>
        <xacro:property name="upper_to_lower_leg_rpy" value="0 0 0" />

        <!-- Joint to fix the leg to the base -->
        <joint name="${prefix}_HAA" type="fixed">
            <parent link="${jnt_pref}base_link" />
            <child link="${jnt_pref}${prefix}_SHOULDER" />
            <origin xyz="${base_to_hip_xyz}" rpy="0 0 0" />
        </joint>
        <!-- Module 1 -->
        <xacro:hip
            prefix="${prefix}"
            gazebo="${gazebo}"
            jnt_pref="${jnt_pref}"
        />
        <!-- Hip joint -->
        <joint name="${prefix}_HFE" type="revolute">
            <parent link="${jnt_pref}${prefix}_SHOULDER" />
            <child link="${jnt_pref}${prefix}_UPPER_LEG" />
            <origin xyz="${hip_to_upper_leg_xyz}" rpy="${hip_to_upper_leg_rpy}" />
            <axis xyz="0 -1 0" />
            <limit effort="2.7" lower="-${PI}" upper="${PI}" velocity="1000" />
            <!-- <dynamics damping="0.7" friction="100.0" /> -->
        </joint>
        <!-- Module 2 link -->
        <xacro:upper_leg
            prefix="${prefix}"
            gazebo="${gazebo}"
            jnt_pref="${jnt_pref}" />
        <!-- Knee joint -->
        <joint name="${prefix}_KFE" type="revolute">
            <parent link="${jnt_pref}${prefix}_UPPER_LEG" />
            <child link="${jnt_pref}${prefix}_LOWER_LEG" />
            <origin xyz="${upper_to_lower_leg_xyz}" rpy="${upper_to_lower_leg_rpy}" />
            <axis xyz="0 -1 0" />
            <limit effort="2.7" lower="-${PI}" upper="${PI}" velocity="1000" />
            <!-- <dynamics damping="0.7" friction="100.0" /> -->
        </joint>
        <!-- Lower leg link -->
        <xacro:lower_leg
            prefix="${prefix}"
            gazebo="${gazebo}"
            jnt_pref="${jnt_pref}" />
    </xacro:macro>

</robot>